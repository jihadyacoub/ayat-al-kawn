<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>آيات الكون</title>
<style>
body { margin:0; font-family: Arial,sans-serif; background:#0b0c1a; color:#fff; overflow:hidden;}
#sky { width:100vw; height:100vh; display:block;}
.modal {display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
  background:#11142b; padding:20px; border-radius:10px; max-width:600px; z-index:10;}
.modal img { width:100%; border-radius:10px; margin-top:10px;}
.modal iframe { margin-top:10px; border-radius:10px;}
.close { cursor:pointer; color:#00ffff; float:right; font-size:20px;}
#searchBar {position:absolute; top:10px; left:50%; transform:translateX(-50%); z-index:20;}
#searchInput {padding:10px; border-radius:5px; border:none; width:250px;}
#sidebar {position:absolute; right:0; top:0; width:250px; height:100%; background:#11142b; overflow-y:auto; padding:10px; z-index:15;}
#sidebar h3 {color:#00ffff;}
#sidebar ul {list-style:none; padding:0;}
#sidebar li {padding:5px; cursor:pointer;}
#sidebar li:hover {background:#22254a; border-radius:5px;}
</style>
</head>
<body>

<div id="searchBar">
  <input type="text" id="searchInput" placeholder="ابحث عن نجم أو آية..." />
</div>

<div id="sidebar">
  <h3>الأجرام السماوية</h3>
  <ul id="starList"></ul>
</div>

<canvas id="sky"></canvas>

<div id="modal" class="modal">
  <span class="close" onclick="document.getElementById('modal').style.display='none'">&times;</span>
  <h2 id="modal-title"></h2>
  <p id="modal-verse"></p>
  <img id="modal-img" src="" alt="صورة الجرم">
  <p id="modal-science"></p>
  <iframe id="modal-video" width="100%" height="200" src="" frameborder="0" allowfullscreen></iframe>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r148/three.min.js"></script>
<script>
// بيانات الأجرام السماوية (JSON مضمّن داخل الكود)
const starsData = [
  {"name":"النجم إذا هوى","verse":"النجم إذا هوى (النجم:1)","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/potw2134a.jpg","video":"https://www.youtube.com/embed/Sc1p09jVfVg","science":"نجم نيوتروني دوار يصدر نبضات ضوئية قوية","position":[2,1,-5],"category":"نجوم"},
  {"name":"الشمس وضحاها","verse":"والشمس وضحاها (الشمس:1)","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/solar.jpg","video":"https://www.youtube.com/embed/8tZCROpOVvM","science":"صورة حديثة للشمس من مسبار باركر الشمسي","position":[-3,0.5,-4],"category":"نجوم"},
  {"name":"القمر قدرناه منازل","verse":"والقمر قدرناه منازل (الأنعام:141)","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/lro-moon.jpg","video":"https://www.youtube.com/embed/Yx_ZtGmV7Zs","science":"صور القمر بالأقمار الصناعية الحديثة","position":[1,-1,-6],"category":"كواكب"},
  {"name":"نجم سيريوس","verse":"لا توجد آية مباشرة","img":"https://upload.wikimedia.org/wikipedia/commons/5/51/Sirius_A_and_B_Hubble_photo.jpg","video":"https://www.youtube.com/embed/H6g6G7A1-UM","science":"ألمع نجم في السماء ليلاً","position":[-4,1,-6],"category":"نجوم"},
  {"name":"كوكب المشتري","verse":"لا توجد آية مباشرة","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/pia22946-16.jpg","video":"https://www.youtube.com/embed/9S0ZbMZ3vP0","science":"أكبر كوكب في النظام الشمسي","position":[5,0,-9],"category":"كواكب"},
  {"name":"كوكب زحل","verse":"لا توجد آية مباشرة","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/pia21046-16.jpg","video":"https://www.youtube.com/embed/b3bHrc0gX5s","science":"كوكب الحلقات الشهير","position":[-5,-1,-10],"category":"كواكب"},
  {"name":"سديم الجبار","verse":"لا توجد آية مباشرة","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/heic0602a.jpg","video":"https://www.youtube.com/embed/gH0Z3x1r1zo","science":"سديم واضح لتكوين النجوم الجديدة","position":[3,3,-9],"category":"سديمات"},
  {"name":"مجرة درب التبانة","verse":"لا توجد آية مباشرة","img":"https://www.nasa.gov/sites/default/files/thumbnails/image/milky_way.jpg","video":"https://www.youtube.com/embed/TfLku0lH7xE","science":"مجرة نظامنا الشمسي","position":[-3,3,-8],"category":"مجرات"}
];

// تهيئة Three.js
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000);
const renderer = new THREE.WebGLRenderer({canvas: document.getElementById('sky'), antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
let starMeshes = [];

starsData.forEach(s => {
  const geometry = new THREE.SphereGeometry(0.1,16,16);
  const material = new THREE.MeshBasicMaterial({color:0xffffff});
  const star = new THREE.Mesh(geometry, material);
  star.position.set(...s.position);
  scene.add(star);
  starMeshes.push({mesh:star, data:s});
});

camera.position.z = 0;

// القائمة الجانبية
function populateSidebar(){
  const starList = document.getElementById('starList');
  starList.innerHTML='';
  starsData.forEach(s => {
    const li = document.createElement('li');
    li.innerText = `${s.name} (${s.category})`;
    li.onclick = ()=>focusStar(s);
    starList.appendChild(li);
  });
}
populateSidebar();

// التفاعل مع الماوس
let raycaster = new THREE.Raycaster();
let mouse = new THREE.Vector2();
let isDragging=false;
let prevMouse={x:0,y:0};

renderer.domElement.addEventListener('mousedown', e=>{isDragging=true; prevMouse={x:e.clientX,y:e.clientY};});
renderer.domElement.addEventListener('mouseup', e=>{isDragging=false;});
renderer.domElement.addEventListener('mousemove', e=>{
  if(isDragging){
    let deltaX=(e.clientX-prevMouse.x)*0.005;
    let deltaY=(e.clientY-prevMouse.y)*0.005;
    scene.rotation.y+=deltaX;
    scene.rotation.x+=deltaY;
    prevMouse={x:e.clientX,y:e.clientY};
  }
});

function animate(){ requestAnimationFrame(animate); renderer.render(scene,camera);}
animate();

window.addEventListener('click', onMouseClick);

function onMouseClick(event){
  mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
  mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
  raycaster.setFromCamera(mouse,camera);
  const intersects=raycaster.intersectObjects(starMeshes.map(s=>s.mesh));
  if(intersects.length>0){
    const clicked = starMeshes.find(s=>s.mesh===intersects[0].object).data;
    showModal(clicked);
  }
}

// البحث
document.getElementById('searchInput').addEventListener('input', function(){
  const query = this.value.trim().toLowerCase();
  if(!query) return;
  const result = starsData.find(s=> s.name.toLowerCase().includes(query) || s.verse.toLowerCase().includes(query));
  if(result){ focusStar(result); showModal(result);}
});

// عرض النافذة
function showModal(star){
  document.getElementById('modal-title').innerText=star.name;
  document.getElementById('modal-verse').innerText=star.verse;
  document.getElementById('modal-img').src=star.img;
  document.getElementById('modal-science').innerText=star.science;
  document.getElementById('modal-video').src=star.video;
  document.getElementById('modal').style.display='block';
}

// تركيز الكاميرا على النجم
function focusStar(star){
  camera.position.set(...star.position.map(v=>v*0.8));
  camera.lookAt(new THREE.Vector3(...star.position));
}
</script>
</body>
</html>